#!/bin/ksh
#
###################################################################################
#
# Configuration file for module "more"
#
###################################################################################
#
#
###################################################################################
# Begin of configuration script
#==================================================================================
if [ -z "$__MORE_CONF__" ]; then __MORE_CONF__=defined        # include-guard begin
###################################################################################
#
#
###################################################################################
# General configuration
#==================================================================================
f_call_set_var  MO_EXPID  ${CY_EXPID:-0001}
###################################################################################
#
#
###################################################################################
# Path specific parameters
#==================================================================================
if [[ "$MO_IN_MODEL" = @(ICON|ICON-LAM) ]]; then
#==================================================================================
f_call_set_var MO_I_RADDIR     ${BA_ROUTFOXFOX}/icon/const
f_call_set_var MO_I_CLDOPTPROP "$(ls -1 $MO_I_RADDIR | grep -i 'cld.*opt.*\.nc$')"
f_call_set_var MO_I_RRTMGCOEFF "$(ls -1 $MO_I_RADDIR | grep -i 'rrtmg.*\.nc$')"
#----------------------------------------------------------------------------------
f_call_set_var MO_I_ECRAD_DIR  ${BA_ROUTFORFOX}/ecrad/const/ecrad-1.3.0
#==================================================================================
fi
###################################################################################
#
#
###################################################################################
# Output specific parameters
#==================================================================================
if [[ "$MO_IN_MODEL" = @(ICON|ICON-LAM) ]]; then
#==================================================================================
f_call_set_var  MO_I_OUT_NEST_LL     1          # output nest fields on latlon grid
f_call_set_var  MO_I_OUT_INI_NATIVE  1       # output init. analysis on native grid
f_call_set_var  MO_I_OUT_NEST_MAIN   1             # output nest fields in main run
#----------------------------------------------------------------------------------
f_call_set_var  MO_I_METEOGRAM       0              # output meteograms in main run
#==================================================================================
fi
###################################################################################
#
#
###################################################################################
# Vertical coordinate specific parameters
#==================================================================================
if [[ "$MO_IN_MODEL" = @(ICON|ICON-LAM) ]]; then
#==================================================================================
f_call_set_var  MO_I_USE_GENV    1            # use generalized vertical coordinate
#==================================================================================
fi
###################################################################################
#
#
###################################################################################
# IAU specific parameters
#==================================================================================
if [[ "$MO_IN_MODEL" = @(ICON|ICON-LAM) ]]; then
#==================================================================================
# init_mode=1 --> to start from DWD analysis (obsolete)
# init_mode=5 --> to start from DWD analysis (make use of IAU)
#----------------------------------------------------------------------------------
f_call_set_var  MO_I_INIT_MODE_DET    5
f_call_set_var  MO_I_INIT_MODE_ENS    5
#==================================================================================
fi
###################################################################################
#
#
###################################################################################
# Observation specific parameters
#==================================================================================
case "$MO_IN_MODEL" in
  COSMO)  f_call_set_var  MO_C_RTTOVVERSION   12;;
esac
###################################################################################
#
#
###################################################################################
# Radiation grid specific parameters
#==================================================================================
case "$MO_IN_MODEL" in
  ICON|ICON-LAM)  f_call_set_var  MO_I_RADGRID   1;;
esac
###################################################################################
#
#
###################################################################################
# todo:troesch:??? specific parameters
#==================================================================================
if [[ "$MO_IN_MODEL" = @(ICON|ICON-LAM) ]]; then
#==================================================================================
# mapfile for mapping ICON internal names to GRIB2 convention
#----------------------------------------------------------------------------------
f_call_set_var  MO_I_MAP_FILE    ${BA_PATH}/const/ana_varnames_map_file.txt
#----------------------------------------------------------------------------------
# definition of relative humidity of interpolated fields
# 1: rh over water (GME); 2: rh over water and ice (IFS)
#----------------------------------------------------------------------------------
f_call_set_var  MO_I_ITYPE_RH_ASS    1
f_call_set_var  MO_I_ITYPE_RH_MAIN   1
#----------------------------------------------------------------------------------
# resolution used for namelist tuning: 'default'|10|13|20|26|40|52|80|160|D2.1|D2.5
# 'default': derive resolution from gridnumber
#----------------------------------------------------------------------------------
f_call_set_var  MO_I_IRES_DET    'default'              # ICON (det) physics tuning
f_call_set_var  MO_I_IRES_ENS    'default'              # ICON (ens) physics tuning
#==================================================================================
fi
###################################################################################
#
#
###################################################################################
# modeltop extension specific parameter
#==================================================================================
if [ "$MO_IN_MODEL" = ICON-LAM ]; then
#==================================================================================
# global model fields for ICON-LAM model top extension
#----------------------------------------------------------------------------------
f_call_set_var  MO_I_MDLEX        0            # 0|1: 1 enables model top extension
f_call_set_var  MO_I_MDLEX_PATH   ${BA_PATH}/iglo_grb
#==================================================================================
fi
###################################################################################
#
#
###################################################################################
# Binary location
#==================================================================================
case "$MO_IN_MODEL" in
  ICON)
    if [ "$MO_IN_MODE" = CLIMA ]; then
      f_call_set_var  MO_BINARY   ${BA_PATH}/bin/icon
    else
      f_call_set_var  MO_BINARY   ${BA_PATH}/bin/icon
      f_call_set_var  MO_WRAPPER  ${BA_PATH}/bin/wrapper
    fi
    ;;
  ICON-LAM)
    f_call_set_var  MO_BINARY   ${BA_PATH}/bin/icon
    f_call_set_var  MO_WRAPPER  ${BA_PATH}/bin/wrapper
    ;;
  COSMO)
    f_call_set_var  MO_BINARY     ${BA_PATH}/bin/lmparbin_all.mpi260
    ;;
esac
###################################################################################
#
#
###################################################################################
# todo:troesch:??? specific parameters
#==================================================================================
if [ "$MO_IN_MODEL" = ICON ]; then
#==================================================================================
# Output delta for generating boundary conditions (0s = off)
#----------------------------------------------------------------------------------
f_call_set_var -t MO_I_GEN_BC_DELTA    3600s
#==================================================================================
fi
###################################################################################
# CLIMA specific parameters
#==================================================================================
if [ "${MO_IN_MODE}" = CLIMA ]; then
  f_call_set_var  MO_CLIMA_RESTART_INTVAL  P${BA_DELT_ASS_ICON_O%mo}M
  f_call_set_var  MO_CLIMA_OUTPUT_INTVAL   P1D
  # file interval must be longer than restart-interval to get useful output files
  f_call_set_var  MO_CLIMA_FILE_INTVAL     P$((${BA_DELT_ASS_ICON_O%mo}+1))M
  f_call_set_var  MO_CLIMA_START_DATE      1980-01-01
  f_call_set_var  MO_CLIMA_END_DATE        2099-01-01
#----------------------------------------------------------------------------------
# Nudging specific parameters
#----------------------------------------------------------------------------------
  f_call_set_var  MO_I_MAP_NUDGE_FILE  ${BA_PATH}/const/nudging_varnames_map_file.txt
  f_call_set_var  MO_I_PATH_NUDG_DATA  ${BA_PATH}/icon_sml/ERA5/nudging/data/
fi
###################################################################################
#
#
###################################################################################
# Batch specific parameters (for submitting the ensemble forecast as small batches;
# otherwise the hpc will be cramped)
#==================================================================================
case "${MO_IN_MODE}" in
  MAIN)    MO_BLOCKSIZE=2;;
  CLIMA)   MO_BLOCKSIZE=2;;
     *)    MO_BLOCKSIZE=4;;
esac
#----------------------------------------------------------------------------------
MO_BLOCKSIZE="$((MO_BLOCKSIZE < 1  ? 1  : MO_BLOCKSIZE))"        # force min. value
MO_BLOCKSIZE="$((MO_BLOCKSIZE > 20 ? 20 : MO_BLOCKSIZE))"        # force max. value
#----------------------------------------------------------------------------------
f_report_var  MO_BLOCKSIZE
###################################################################################
#
#
###################################################################################
# Local model specific parameters
#==================================================================================
case "${MO_IN_MODEL}:${MO_IN_MODE}" in    # latent heat nudging: active|passive|off
  COSMO:ASS)        f_call_set_var  MO_L_LHN   'active';;
  COSMO:MAIN)       f_call_set_var  MO_L_LHN   'active';;
  ICON-LAM:ASS)     f_call_set_var  MO_L_LHN   'active';;
  ICON-LAM:MAIN)    f_call_set_var  MO_L_LHN   'off';;
  ICON-LAM:*)       f_call_set_var  MO_L_LHN   'off';;
esac
#----------------------------------------------------------------------------------
case "${MO_IN_MODEL}:${MO_IN_MODE}" in   # run MAIN (ILAM) with interp. ICON-EU 0|1
  ICON-LAM:MAIN)
    f_call_set_var  MO_L_MAIN_FROM_IEU   1 #${EX_MO_L_MAIN_FROM_IEU:-0};;
esac
###################################################################################
#
#
###################################################################################
# COSMO specific parameters
#==================================================================================
if [ "$MO_IN_MODEL" = COSMO ]; then
#==================================================================================
f_call_set_var MO_C_VERIF     1                       # COSMO writes fof-files: 0|1
f_call_set_var MO_C_CONSTDIR  ${BA_PATH}/const/mo_const
f_call_set_var MO_C_SSOFILE   sso_laf2016030100_cosmode
#==================================================================================
fi
###################################################################################
#
#
###################################################################################
# End of configuration file
#==================================================================================
f_error_end_of_script
#----------------------------------------------------------------------------------
fi                                                              # include-guard end
###################################################################################
